<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.newjeanssa.budongbudong.model.dao.HouseDao">
    <resultMap type="AptDto" id="AptResultMap">
        <id property="aptId" column="apt_id" />
        <result property="dongCode" column="dong_code" />
        <result property="aptName" column="apt_name" />
        <result property="totalDong" column="total_dong" />
        <result property="salePrice" column="sale_price" />
        <result property="rentPrice" column="rent_price" />
        <result property="totalHouseholds" column="total_households" />
        <result property="aptFloor" column="apt_floor" />
        <result property="approvalDate" column="approval_date" />
        <result property="totalParkingLot" column="total_parking_lot" />
        <result property="floorAreaRatio" column="floor_area_ratio" />
        <result property="buildingLandRatio" column="building_land_ratio" />
        <result property="constructionCompany" column="construction_company" />
        <result property="heatingSystem" column="heating_system" />
        <result property="managementOffice" column="management_office" />
        <result property="aptAddress" column="apt_address" />
        <result property="schoolName" column="school_name" />
        <result property="schoolDist" column="school_dist" />
        <result property="schoolAddress" column="school_address" />
        <result property="aptHit" column="apt_hit" />
        <result property="totalScore" column="total_score" />
        <result property="interiorScore" column="interior_score" />
        <result property="facilitiesScore" column="facilities_score" />
    </resultMap>

    <resultMap type="AptAreaDto" id="AptAreaResultMap">
        <id property="aptAreaId" column="apt_area_id" />
        <id property="aptId" column="apt_id" />
        <result property="aptAreaImg" column="apt_area_img" />
        <result property="aptAreaSupplyExclusive" column="apt_area_supply_exclusive" />
        <result property="totalRoom" column="total_room" />
        <result property="aptAreaTotalHouseholds" column="apt_area_total_households" />
        <result property="frontDoorStructure" column="front_door_structure" />
        <result property="price" column="price" />
        <result property="aptAreaRealTrans" column="apt_area_real_trans" />
        <result property="administrationCost" column="administration_cost" />
        <result property="holdingTax" column="holding_tax" />
        <result property="upperLimitSale" column="upper_limit_sale" />
        <result property="lowerLimitSale" column="lower_limit_sale" />
        <result property="upperLimitRent" column="upper_limit_rent" />
        <result property="lowerLimitRent" column="lower_limit_rent" />
        <result property="saleCompRent" column="sale_comp_rent" />
        <collection property="aptRealHistoryList" ofType="AptRealHistoryDto">
            <id property="aptRealHistoryId" column="apt_real_history_id" />
            <result property="aptAreaId" column="apt_area_id" />
            <result property="aptId" column="apt_id" />
            <result property="aptRealHistoryMonth" column="apt_real_history_month" />
            <result property="aptRealHistoryType" column="apt_real_history_type" />
            <result property="aptRealHistoryPrice" column="apt_real_history_price" />
        </collection>
    </resultMap>

    <resultMap type="AptRealTransDto" id="AptRealTransResultMap">
        <id property="aptRealTransId" column="apt_real_trans_id" />
        <result property="aptId" column="apt_id" />
        <result property="apt_real_trans_name" column="apt_real_trans_name" />
        <result property="apt_real_trans_price" column="apt_real_trans_price" />
        <result property="apt_real_trans_img" column="apt_real_trans_img" />
        <result property="apt_real_trans_floor" column="apt_real_trans_floor" />
        <result property="apt_real_trans_dir" column="apt_real_trans_dir" />
        <result property="apt_real_trans_area" column="apt_real_trans_area" />
    </resultMap>

    <resultMap id="AptInfoResultMap" type="AptDto" extends="AptResultMap">
        <collection property="aptRealTransList" resultMap="AptRealTransResultMap" />
    </resultMap>

    <select id="findHouseList" parameterType="HouseRequest" resultType="AptCodeDto">
        SELECT t2.apt_id aptCode, t2.apt_name aptName, t2.apt_address aptAddress
        FROM dong_code t1 JOIN apt t2 ON t1.dong_code = t2.dong_code
        WHERE t1.sido_name = #{sidoName} AND t1.gugun_name = #{gugunName} AND t1.dong_name = #{dongName}
    </select>

    <update id="updateHit" parameterType="String">
        UPDATE apt
        SET apt_hit = apt_hit + 1
        WHERE apt_id = #{aptCode}
    </update>

    <select id="findHouseDetail" parameterType="String" resultMap="AptInfoResultMap">
        SELECT t1.apt_id aptId, t1.dong_code dongCode, t1.apt_name aptName, t1.total_dong totalDong, t1.sale_price salePrice, t1.rent_price rentPrice,
               t1.total_households totalHouseholds, t1.apt_floor aptFloor, t1.approval_date approvalDate, t1.total_parking_lot totalParkingLot,
               t1.floor_area_ratio floorAreaRatio, t1.building_land_ratio buildingLandRatio, t1.construction_company constructionCompany,
               t1.heating_system heatingSystem, t1.management_office managementOffice, t1.apt_address aptAddress, t1.school_name schoolName,
               t1.school_dist schoolDist, t1.school_address schoolAddress, t1.apt_hit aptHit, t1.total_score totalScore, t1.interior_score interiorScore, t1.facilities_score facilitiesScore,
               t2.apt_real_trans_id aptRealTransId, t2.apt_real_trans_name aptRealTransName, t2.apt_real_trans_price aptRealTransPrice, t2.apt_real_trans_img aptRealTransImg,
               t2.apt_real_trans_floor aptRealTransFloor, t2.apt_real_trans_dir aptRealTransDir, t2.apt_real_trans_area aptRealTransArea
        FROM apt t1 JOIN apt_real_trans t2 ON t1.apt_id = t2.apt_id
        WHERE t1.apt_id = #{aptCode}
    </select>

<!--    <select id="findHouseDetail" parameterType="String" resultMap="AptInfoResultMap">-->
<!--        SELECT t1.apt_id aptId, t1.dong_code dongCode, t1.apt_name aptName, t1.total_dong totalDong, t1.sale_price salePrice, t1.rent_price rentPrice,-->
<!--               t1.total_households totalHouseholds, t1.apt_floor aptFloor, t1.approval_date approvalDate, t1.total_parking_lot totalParkingLot,-->
<!--               t1.floor_area_ratio floorAreaRatio, t1.building_land_ratio buildingLandRatio, t1.construction_company constructionCompany,-->
<!--               t1.heating_system heatingSystem, t1.management_office managementOffice, t1.apt_address aptAddress, t1.school_name schoolName,-->
<!--               t1.school_dist schoolDist, t1.school_address schoolAddress, t1.apt_hit aptHit, t1.total_score totalScore, t1.interior_score interiorScore, t1.facilities_score facilitiesScore,-->
<!--               t2.apt_real_trans_id aptRealTransId, t2.apt_real_trans_name aptRealTransName, t2.apt_real_trans_price aptRealTransPrice, t2.apt_real_trans_img aptRealTransImg,-->
<!--               t2.apt_real_trans_floor aptRealTransFloor, t2.apt_real_trans_dir aptRealTransDir, t2.apt_real_trans_area aptRealTransArea,-->
<!--               t3.apt_area_id aptAreaId, t3.apt_area_img aptAreaImg, t3.apt_area_supply_exclusive aptAreaSupplyExclusive, t3.total_room totalRoom,-->
<!--               t3.apt_area_total_households aptAreaTotalHouseholds, t3.front_door_structure frontDoorStructure, t3.price price, t3.apt_area_real_trans aptAreaRealTrans,-->
<!--               t3.administration_cost administrationCost, t3.holding_tax holdingTax, t3.upper_limit_sale upperLimitSale, t3.lower_limit_sale lowerLimitSale,-->
<!--               t3.upper_limit_rent upperLimitRent, t3.lower_limit_rent lowerLimitRent, t3.sale_comp_rent saleCompRent, t4.apt_real_history_id aptRealHistoryId,-->
<!--               t4.apt_real_history_month aptRealHistoryMonth, t4.apt_real_history_type aptRealHistoryType, t4.apt_real_history_price aptRealHistoryPrice-->
<!--        FROM apt t1 JOIN apt_real_trans t2 ON t1.apt_id = t2.apt_id-->
<!--                    JOIN apt_area t3 ON t1.apt_id = t3.apt_id-->
<!--                    JOIN apt_real_history t4 ON t3.apt_id = t4.apt_id AND t3.apt_area_id = t4.apt_area_id-->
<!--        WHERE t1.apt_id = #{aptCode}-->
<!--    </select>-->

<!--    <select id="findHouseCompareList" parameterType="HouseDealRequest" resultMap="AptInfoResultMap">-->
<!--        SELECT t2.aptCode, t2.roadName, t2.dong, t2.apartmentName, t2.lng, t2.lat, t3.dealYear, t3.dealMonth, t3.dealDay, t3.area, t3.floor-->
<!--        FROM dongcode t1 JOIN houseinfo t2 ON t1.dongCode = t2.dongCode-->
<!--            JOIN housedeal t3 ON t2.aptCode = t3.aptCode-->
<!--        WHERE t1.sidoName = #{sidoName} AND t1.gugunName = #{gugunName} AND t1.dongName = #{dongName}-->
<!--            AND t3.dealYear = #{dealYear} AND t3.dealMonth = #{dealMonth}-->
<!--    </select>-->
</mapper>